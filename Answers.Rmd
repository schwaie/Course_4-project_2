---
title: "Answers"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Questions

First, let's download and read the files:
```{r}
if(!file.exists("./data")) {dir.create("./data")}
url <- "https://d396qusza40orc.cloudfront.net/exdata%2Fdata%2FNEI_data.zip"
download.file(url, destfile = "./data/dataset.zip", mode = "wb")
unzip(zipfile="./data/dataset.zip", exdir="./data")
NEI <- readRDS("./data/summarySCC_PM25.rds")
SCC <- readRDS("./data/Source_Classification_Code.rds")
```


### Question 1

Have total emissions from PM2.5 decreased in the United States from 1999 to 2008? Using the base plotting system, make a plot showing the total PM2.5 emission from all sources for each of the years 1999, 2002, 2005, and 2008.

```{r}
emissionsTotal <- aggregate(Emissions ~ year,NEI, sum)
barplot(emissionsTotal$Emissions,names.arg=emissionsTotal$year, xlab="Year",
ylab="PM2.5 Emissions",main="Total PM2.5 Emissions From All US Sources")
```

![plot 1](https://github.com/schwaie/Course_4-project_2/blob/master/plot1.png)

The plot shows that there is a downward trend in total pm2.5 emissions from 1999 to 2008. 

So the answer is yes, total emissions from PM2.5 has decreased from 1999 to 2008. 

### Question 2

Have total emissions from PM2.5 decreased in the Baltimore City, Maryland (fips=="24510") from 1999 to 2008? Use the base plotting system to make a plot answering this question.

```{r}
baltCity<-subset(NEI, fips=="24510")
emissionsBalt <- aggregate(Emissions ~ year,baltCity, sum)
barplot(emissionsBalt$Emissions, names.arg=emissionsBalt$year, xlab="Year", 
        ylab="PM2.5 Emissions", 
        main="Total PM2.5 Emissions From Baltimore City, Maryland")
```

![plot 2](https://github.com/schwaie/Course_4-project_2/blob/master/plot2.png)

Although there is a jump in emissions in Baltimore City in 2005, overall it looks again as if there is a downward trend in emissions since 1999. So yes, total emissions decreased in Baltimore City. 

### Question 3

Of the four types of sources indicated by the ```type``` (point, nonpoint, onroad, nonroad) variable, which of these four sources have seen decreases in emissions from 1999–2008 for Baltimore City? Which have seen increases in emissions from 1999–2008? Use the ggplot2 plotting system to make a plot answer this question.

```{r}
baltCity<-subset(NEI, fips=="24510")
library(ggplot2)
ggplot(baltCity, aes(factor(year), Emissions, fill=type)) + geom_bar(stat="identity") + 
        facet_grid(.~type) + labs(x="Year", y="Total PM2.5 Emissions") + 
        labs(title=expression("PM2.5 Emissions from Baltimore City by Source Type"))
```

![plot 3](https://github.com/schwaie/Course_4-project_2/blob/master/plot3.png)
The plot shows that for all types except "Point", the total emission is reduced for all types. 
Non-road, nonpoint and on-road sources all show reduced emissions in Baltimore City from 1999 to 2008
Point is the only source type that shows an increase in emissions from 1999 to 2008. 

### Question 4

Across the United States, how have emissions from coal combustion-related sources changed from 1999–2008?

To answer this question, use the SCC file to identify sources from coal and combustion.
I used ```unique((SCC$SCC.Level.One))``` and then for Level.Two, Level.Three and Level.Four to identify coal and combustion sources. 
From the SCC file, Level.One contains combustion sources, and Level.Four contains coal sources. The ```grepl``` function will grab rows containing "comb" from Level.One or "coal" from Level.Four. 
Subset the NEI data to contain only those rows, then calculate the total emissions from those years, and plot the data. 

```{r}
combustion <- grepl("comb", SCC$SCC.Level.One, ignore.case=TRUE)
coal <- grepl("coal", SCC$SCC.Level.Four, ignore.case=TRUE)
combustionCoal <- (combustion & coal)
combustionCoalSCC <- SCC[combustionCoal,]$SCC

## subset NEI data by coal and combustion in SCC
combustionCoalNEI <- NEI[NEI$SCC %in% combustionCoalSCC,]

#### get total combustion and coal emission data for years 1999, 2002, 2005, 2008
combCoalEmissionsTotal <- aggregate(Emissions ~ year,combustionCoalNEI, sum)

##plot the data
barplot(
        combCoalEmissionsTotal$Emissions,
        names.arg=combCoalEmissionsTotal$year,
        xlab="Year",
        ylab="PM2.5 Emissions",
        main="Total PM2.5 Emissions From Coal Combustion-Related Sources"
)
```

From this, we can see that the total emissions from coal combustion-related sources has decreased from 1999 to 2008. 

### Question 5
How have emissions from motor vehicle sources changed from 1999–2008 in Baltimore City?

To do this, I use ```unique(SCC$SCC.Level.One)``` and then for the other levels to find motor vehicle related sources. These are found in level two.
Grab the vehicle rows using the ```grepl``` function
subset NEI data to get only vehicle related rows
Subset data to get only Baltimore City emissions (using fips=24510)
Calculate the total emissions from motor vehicles in Baltimore City per year
Plot the data

```{r}
vehicle <- grepl("vehicle", SCC$SCC.Level.Two, ignore.case=TRUE)
vehicleSCC <- SCC[vehicle,]$SCC
vehicleNEI <- NEI[NEI$SCC %in% vehicleSCC,]
baltCityVehicle<-subset(vehicleNEI, fips=="24510")
emissionsBaltVehicle <- aggregate(Emissions ~ year, baltCityVehicle, sum)
barplot(emissionsBaltVehicle$Emissions, names.arg=emissionsBaltVehicle$year, xlab="Year", 
        ylab="PM2.5 Emissions", 
        main="Total PM2.5 Emissions From Motor Vehicle Sources in Baltimore City, Maryland")
```

From this plot, we can see that the total emissions from motor vehicle sources in Baltimore City have decreased from 1999 to 2008. 

### Question 6
Compare emissions from motor vehicle sources in Baltimore City with emissions from motor vehicle sources in Los Angeles County, California (fips=="06037"). Which city has seen greater changes over time in motor vehicle emissions?

To answer this question, it's best to make a dataframe containing the subsetted data for Baltimore City and Los Angeles. The dataframe vehicleNEI already contains the subsetted data for vehicle emissions, so we just need the data for Baltimore City and Los Angeles. 
Once we have the subsetted dataframes, use the rbind function to bind the two dataframes together. 
Then, use ggplot to plot the data.
Note: I tried this first by using ```par(mfrow=c(1,2))``` but the plots had different ylims so I tried ggplot instead. 

```{r}
baltCityVehicle <- vehicleNEI[vehicleNEI$fips==24510,]
baltCityVehicle$city <- "Baltimore City"
losAngelesVehicle <- vehicleNEI[vehicleNEI$fips=="06037",]
losAngelesVehicle$city <- "Los Angeles"
BaltLA <- rbind(baltCityVehicle, losAngelesVehicle)

ggplot(BaltLA, aes(x=factor(year), y=Emissions, fill=city)) +
        geom_bar(aes(fill=year),stat="identity") +
        facet_grid(scales="free", space="free", .~city) +
        labs(x="year", y=expression("Total PM2.5 Emissions")) + 
        labs(title=expression("Total PM2.5 Emissions From Motor Vehicle Source 
                              Emissions in Baltimore and Los Angeles"))
```

Based on this, we can see that Baltimore City showed a decrease from 1999 to 2008. The same cannot be said about Los Angeles. There is no decrease, but there is a bigger change than for Baltimore City. Thus, LA has seen the bigger changes in motor vehicle emissions from 1999 to 2008. 

